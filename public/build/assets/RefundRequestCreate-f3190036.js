import{_ as B,u as F,a as N,m as D,f as i,o as _,g as p,i as r,t as n,v as j,w as a,j as z,l as v,h as o,p as h,F as G,k as I}from"./app-81c86c8f.js";const J={data:()=>({v$:F(),form:{refund_items:[],refund_reasons:[],refund_note:"",attachments:null},orderCode:null,order:{},loading:!1}),validations:{form:{refund_reasons:{},refund_note:{required:N}}},computed:{...D("app",["refundSettings"]),headers(){return[{title:"#",align:"start",sortable:!1,value:"serial"},{title:this.$i18n.t("product"),sortable:!1,value:"product"},{title:this.$i18n.t("quantity"),sortable:!1,value:"quantity"},{title:this.$i18n.t("unit_price"),sortable:!1,value:"unit_price"},{title:this.$i18n.t("total"),sortable:!1,align:"end",value:"total"}]},refundReasonsErrors(){const e=[];return this.v$.form.refund_reasons.$dirty&&!this.v$.form.refund_reasons.required&&e.push(this.$i18n.t("this_field_is_required")),e},refundNoteErrors(){const e=[];return this.v$.form.refund_note.$dirty&&!this.v$.form.refund_note.required&&e.push(this.$i18n.t("this_field_is_required")),e}},methods:{async getDetails(e){const t=await this.call_api("get",`user/refund-request/create/${e}`);t.data.success?(this.orderCode=t.data.order_code,this.order=t.data.order,this.order.products.data.forEach(l=>{let m={status:!1,order_detail_id:l.order_detail_id,quantity:l.quantity,unit_price:l.price,unit_tax:l.tax};this.form.refund_items.push(m)})):(this.snack({message:t.data.message,color:"red"}),this.$router.push({name:"404"}))},async sendRefundRequest(){if(!await this.v$.$validate())return;let t=this.form.refund_items.map(d=>d.status).filter(d=>d);if(t.length==0){this.snack({message:this.$i18n.t("please_select_a_product."),color:"red"});return}this.loading=!0,t=JSON.stringify(this.form.refund_items.map(d=>({order_detail_id:d.order_detail_id,quantity:d.quantity,status:d.status})).filter(d=>d.status));let l=new FormData;l.append("refund_items",t),l.append("order_id",this.order.id),l.append("refund_reasons",this.form.refund_reasons),l.append("refund_note",this.form.refund_note),this.form.attachments&&this.form.attachments.forEach((d,f)=>{l.append(`attachments[${f}]`,d)});const m=await this.call_api("post","user/refund-request/store",l,!0);m.data.success?(this.snack({message:m.data.message}),this.$router.push({name:"RefundRequests"})):this.snack({message:m.data.message,color:"red"}),this.loading=!1},calculateRefund(){let e=0;this.form.refund_items.forEach(t=>{e+=t.status?(t.unit_price+t.unit_tax)*t.quantity:0}),this.form.refund_amount=e}},created(){this.getDetails(this.$route.params.orderId)}},L={class:"ps-lg-7 pt-4"},M={class:"text-h6 fw-700 mb-2"},O={class:"d-flex align-center"},T=["src","alt"],Y={class:"flex-grow-1 ms-4"},A={class:"text-truncate-2"},H={key:0,class:""},K={class:"opacity-70"},P={class:"fw-500"},Q={class:"d-block fw-600"},W={class:"d-block fw-600"},X={key:0,class:"mb-3"},Z={class:"mb-1 fs-13 fw-500"},x=["item"],ee={class:"mb-3"},te={class:"mb-1 fs-13 fw-500"},se={class:"mb-3"},ae={class:"mb-1 fs-13 fw-500"};function re(e,t,l,m,d,f){const g=i("v-card-title"),y=i("v-checkbox"),q=i("vue-number-input"),k=i("v-data-table"),b=i("v-card-text"),$=i("v-card"),V=i("v-list-item"),w=i("v-select"),R=i("v-textarea"),C=i("v-chip"),E=i("v-file-input"),S=i("v-btn"),U=i("v-form");return _(),p("div",L,[r("h1",M,n(e.$t("create_new_refund_request")),1),e.is_empty_obj(e.order)?v("",!0):(_(),j(U,{key:0,"lazy-validation":"",onSubmit:t[6]||(t[6]=z(s=>f.sendRefundRequest(),["prevent"])),autocomplete:"chrome-off",enctype:"multipart/form-data"},{default:a(()=>[o($,{class:"mb-6",outlined:""},{default:a(()=>[o(g,null,{default:a(()=>[h(n(e.$t("order_code"))+": "+n(e.orderCode),1)]),_:1}),o(b,null,{default:a(()=>[o(k,{headers:f.headers,items:e.order.products.data,class:"","hide-default-footer":"","mobile-breakpoint":"750","item-key":"order_detail_id"},{"item.serial":a(({item:s,index:u})=>[o(y,{"true-icon":"las la-check",modelValue:e.form.refund_items[u].status,"onUpdate:modelValue":c=>e.form.refund_items[u].status=c,class:"mt-1","hide-details":"",name:"order_detail_ids"},null,8,["modelValue","onUpdate:modelValue"])]),"item.product":a(({item:s})=>[r("div",O,[r("img",{src:s.thumbnail,alt:s.name,onError:t[0]||(t[0]=u=>e.imageFallback(u)),class:"size-70px flex-shrink-0"},null,40,T),r("div",Y,[r("div",A,n(s.name),1),s.combinations.length>0?(_(),p("div",H,[(_(!0),p(G,null,I(s.combinations,(u,c)=>(_(),p("span",{key:c,class:"me-4 py-1 fs-12"},[r("span",K,n(u.attribute),1),h(" : "),r("span",P,n(u.value),1)]))),128))])):v("",!0)])])]),"item.quantity":a(({item:s,index:u})=>[o(q,{modelValue:e.form.refund_items[u].quantity,"onUpdate:modelValue":c=>e.form.refund_items[u].quantity=c,min:1,max:s.quantity,step:1,align:"center",size:"110px"},null,8,["modelValue","onUpdate:modelValue","max"])]),"item.unit_price":a(({item:s})=>[r("span",Q,n(e.format_price(s.price+s.tax)),1)]),"item.total":a(({item:s})=>[r("span",W,n(e.format_price(s.total)),1)]),_:2},1032,["headers","items"])]),_:1})]),_:1}),o($,{class:"mb-6",outlined:""},{default:a(()=>[o(g,{class:""},{default:a(()=>[h(n(e.$t("refund_information")),1)]),_:1}),o(b,null,{default:a(()=>[e.refundSettings.refund_reason_types&&e.refundSettings.refund_reason_types.length>0?(_(),p("div",X,[r("div",Z,n(e.$t("refund_reasons")),1),o(w,{modelValue:e.form.refund_reasons,"onUpdate:modelValue":t[1]||(t[1]=s=>e.form.refund_reasons=s),items:e.refundSettings.refund_reason_types,label:e.$t("choose_one"),"menu-props":{offsetY:!0},onBlur:t[2]||(t[2]=s=>e.v$.form.refund_reasons.$touch()),"hide-details":"auto",flat:"",variant:"outlined",solo:"",multiple:"",required:""},{default:a(()=>[r("template",{item:{item:e.item}},[o(V,{title:e.item.title},null,8,["title"])],8,x)]),_:1},8,["modelValue","items","label"])])):v("",!0),r("div",ee,[r("div",te,n(e.$t("refund_note")),1),o(R,{placeholder:e.$t("refund_note"),onBlur:t[3]||(t[3]=s=>e.v$.form.refund_note.$touch()),"hide-details":"auto",rows:"3",modelValue:e.form.refund_note,"onUpdate:modelValue":t[4]||(t[4]=s=>e.form.refund_note=s),required:"",variant:"outlined","no-resize":""},null,8,["placeholder","modelValue"])]),r("div",se,[r("div",ae,n(e.$t("attachments")),1),o(E,{label:e.$t("select_images"),"prepend-icon":"",accept:"image/png, image/jpg, image/jpeg","hide-details":"auto",variant:"outlined",multiple:"",dense:"",solo:"",flat:"",clearable:"","clear-icon":"las la-times",modelValue:e.form.attachments,"onUpdate:modelValue":t[5]||(t[5]=s=>e.form.attachments=s)},{selection:a(({text:s})=>[o(C,{small:"",label:"",color:"primary"},{default:a(()=>[h(n(s),1)]),_:2},1024)]),_:1},8,["label","modelValue"])]),o(S,{type:"submit",color:"primary",elevation:"0",onClick:f.sendRefundRequest,loading:e.loading,disabled:e.loading,class:"px-10 mt-2"},{default:a(()=>[h(n(e.$t("request_refund")),1)]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1}))])}const ne=B(J,[["render",re]]);export{ne as default};
